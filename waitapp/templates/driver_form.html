{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check In</title>
    <link rel="stylesheet" href="{% static 'css/menu.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="top-bar">
        <div class="logo-container">
            <img src="{% static 'images/Level1DA.PNG' %}" alt="Company Logo" class="logo">
        </div> 
    </div>
    <div class="main-content">
        <div class="splash-screen">
            <div class="splash-content">
                <img src="{% static 'images/Level1DA.PNG' %}" alt="Company Logo" class="splash-logo">
                <h1>{% trans "Welcome!" %}</h1>
            </div>
        </div>
    <div class="center-text">
        <h1>{% trans "Driver Check-In" %}</h1>
        <h3 class="select-option">{% trans "Please fill out the form below to check-in" %}</h3>
    </div>
    
    <div class="form-container">
        <form method="post" class="sleek-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="{{ form.name.id_for_label }}" class="form-label">{% trans "Driver Name" %}</label>
                {{ form.name }}
            </div>
            <div class="form-group">
                <label for="{{ form.name.id_for_label}}" class="form-label">{% trans "Phone Number" %}</label>
                {{ form.phone_number }}
            </div>
           <div class="form-group" style="display: flex; align-items: center; gap: 10px; flex-wrap: nowrap;">
                <label for="{{ form.is_follow_up.id_for_label }}" class="form-label" style="margin: 0; white-space: nowrap;">
                    {% trans "Are you a Follow Up Driver?" %}
                </label>
                {{ form.is_follow_up }}
            </div>
            <div class="form-group" id="company-group">
                <label for="{{ form.company.id_for_label }}" class="form-label">{% trans "Company" %}</label>
                {{ form.company }}
            </div>

            {{ form.errors }}
            <button type="submit" class="menu-button">{% trans "Submit" %}</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const followUpCheckbox = document.getElementById('{{ form.is_follow_up.id_for_label }}');
            const companyGroup = document.getElementById('company-group');
            const phoneInput = document.getElementById('{{ form.phone_number.id_for_label }}');
            
            function toggleCompanyField() {
                if (followUpCheckbox.checked) {
                    companyGroup.style.display = 'none';
                } else {
                    companyGroup.style.display = 'block';
                }
            }
            
            // Phone number formatting
            function formatPhoneNumber(value) {
                // Remove all non-digit characters
                const digits = value.replace(/\D/g, '');
                
                // Limit to 10 digits
                const limitedDigits = digits.substring(0, 10);
                
                // Apply formatting
                if (limitedDigits.length >= 6) {
                    return limitedDigits.replace(/(\d{3})(\d{3})(\d{1,4})/, '$1-$2-$3');
                } else if (limitedDigits.length >= 3) {
                    return limitedDigits.replace(/(\d{3})(\d{1,3})/, '$1-$2');
                } else {
                    return limitedDigits;
                }
            }
            
            // Phone input event listeners
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    const formattedValue = formatPhoneNumber(e.target.value);
                    e.target.value = formattedValue;
                });
                
                phoneInput.addEventListener('keydown', function(e) {
                    // Allow backspace, delete, tab, escape, enter
                    if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                        // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                        (e.keyCode === 65 && e.ctrlKey === true) ||
                        (e.keyCode === 67 && e.ctrlKey === true) ||
                        (e.keyCode === 86 && e.ctrlKey === true) ||
                        (e.keyCode === 88 && e.ctrlKey === true)) {
                        return;
                    }
                    // Ensure that it is a number and stop the keypress
                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });
            }
            
            // Initial state
            toggleCompanyField();
            
            // Listen for changes
            followUpCheckbox.addEventListener('change', toggleCompanyField);
        });
    </script>
    </div>

    <!-- Footer with Watermark -->
    <div class="footer-watermark">
        <div class="powered-by">
            <p>{% trans "Powered by" %} <strong>Innovate Tech Solutions</strong></p>
        </div>
    </div>
    {% block extra_js %}{% endblock %}
</body>
</html>